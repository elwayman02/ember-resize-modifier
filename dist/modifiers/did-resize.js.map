{"version":3,"file":"did-resize.js","sources":["../../src/modifiers/did-resize.ts"],"sourcesContent":["import Modifier from 'ember-modifier';\nimport { registerDestructor } from '@ember/destroyable';\n\nimport type Owner from '@ember/owner';\nimport type { ArgsFor } from 'ember-modifier';\n\nexport type DidResizeHandler = (\n  entry: ResizeObserverEntry,\n  observer: ResizeObserver,\n) => void;\n\nexport interface DidResizeSignature {\n  Args: {\n    Positional: [handler: DidResizeHandler, options?: ResizeObserverOptions];\n  };\n  Element: Element;\n}\n\nexport default class DidResizeModifier extends Modifier<DidResizeSignature> {\n  // Public API\n  declare element: Element;\n  declare handler: DidResizeHandler;\n  options: ResizeObserverOptions = {};\n\n  // Private API\n  static observer: ResizeObserver | null = null;\n  static handlers: WeakMap<Element, DidResizeHandler> | null = null;\n\n  constructor(owner: Owner, args: ArgsFor<DidResizeSignature>) {\n    super(owner, args);\n\n    if (!('ResizeObserver' in window)) {\n      return;\n    }\n\n    if (!DidResizeModifier.observer) {\n      DidResizeModifier.handlers = new WeakMap();\n      DidResizeModifier.observer = new ResizeObserver(\n        (entries: ResizeObserverEntry[], observer: ResizeObserver) => {\n          window.requestAnimationFrame(() => {\n            for (const entry of entries) {\n              const handler = DidResizeModifier.handlers?.get(entry.target);\n              if (handler) handler(entry, observer);\n            }\n          });\n        },\n      );\n    }\n\n    registerDestructor(this, unobserve);\n  }\n\n  modify(\n    element: Element,\n    positional: [DidResizeHandler, ResizeObserverOptions?],\n  ) {\n    unobserve(this);\n\n    this.element = element;\n\n    const [handler, options] = positional;\n\n    // Save arguments for when we need them\n    this.handler = handler;\n    this.options = options ?? this.options;\n\n    this.observe();\n  }\n\n  observe() {\n    if (DidResizeModifier.observer) {\n      this.addHandler();\n      DidResizeModifier.observer.observe(this.element, this.options);\n    }\n  }\n\n  addHandler() {\n    DidResizeModifier.handlers?.set(this.element, this.handler);\n  }\n\n  removeHandler() {\n    DidResizeModifier.handlers?.delete(this.element);\n  }\n}\n\n/**\n * Destructor function for the modifier\n */\nfunction unobserve(instance: DidResizeModifier) {\n  if (instance.element && DidResizeModifier.observer) {\n    DidResizeModifier.observer.unobserve(instance.element);\n    instance.removeHandler();\n  }\n}\n"],"names":["DidResizeModifier","Modifier","options","observer","handlers","constructor","owner","args","window","WeakMap","ResizeObserver","entries","requestAnimationFrame","entry","handler","get","target","registerDestructor","unobserve","modify","element","positional","observe","addHandler","set","removeHandler","delete","instance"],"mappings":";;;AAkBe,MAAMA,iBAAiB,SAASC,QAAQ,CAAqB;AAC1E;;EAGAC,OAAO,GAA0B,EAAE;;AAEnC;EACA,OAAOC,QAAQ,GAA0B,IAAI;EAC7C,OAAOC,QAAQ,GAA8C,IAAI;AAEjEC,EAAAA,WAAWA,CAACC,KAAY,EAAEC,IAAiC,EAAE;AAC3D,IAAA,KAAK,CAACD,KAAK,EAAEC,IAAI,CAAC;AAElB,IAAA,IAAI,EAAE,gBAAgB,IAAIC,MAAM,CAAC,EAAE;AACjC,MAAA;AACF,IAAA;AAEA,IAAA,IAAI,CAACR,iBAAiB,CAACG,QAAQ,EAAE;AAC/BH,MAAAA,iBAAiB,CAACI,QAAQ,GAAG,IAAIK,OAAO,EAAE;MAC1CT,iBAAiB,CAACG,QAAQ,GAAG,IAAIO,cAAc,CAC7C,CAACC,OAA8B,EAAER,QAAwB,KAAK;QAC5DK,MAAM,CAACI,qBAAqB,CAAC,MAAM;AACjC,UAAA,KAAK,MAAMC,KAAK,IAAIF,OAAO,EAAE;YAC3B,MAAMG,OAAO,GAAGd,iBAAiB,CAACI,QAAQ,EAAEW,GAAG,CAACF,KAAK,CAACG,MAAM,CAAC;AAC7D,YAAA,IAAIF,OAAO,EAAEA,OAAO,CAACD,KAAK,EAAEV,QAAQ,CAAC;AACvC,UAAA;AACF,QAAA,CAAC,CAAC;AACJ,MAAA,CACF,CAAC;AACH,IAAA;AAEAc,IAAAA,kBAAkB,CAAC,IAAI,EAAEC,SAAS,CAAC;AACrC,EAAA;AAEAC,EAAAA,MAAMA,CACJC,OAAgB,EAChBC,UAAsD,EACtD;IACAH,SAAS,CAAC,IAAI,CAAC;IAEf,IAAI,CAACE,OAAO,GAAGA,OAAO;AAEtB,IAAA,MAAM,CAACN,OAAO,EAAEZ,OAAO,CAAC,GAAGmB,UAAU;;AAErC;IACA,IAAI,CAACP,OAAO,GAAGA,OAAO;AACtB,IAAA,IAAI,CAACZ,OAAO,GAAGA,OAAO,IAAI,IAAI,CAACA,OAAO;IAEtC,IAAI,CAACoB,OAAO,EAAE;AAChB,EAAA;AAEAA,EAAAA,OAAOA,GAAG;IACR,IAAItB,iBAAiB,CAACG,QAAQ,EAAE;MAC9B,IAAI,CAACoB,UAAU,EAAE;AACjBvB,MAAAA,iBAAiB,CAACG,QAAQ,CAACmB,OAAO,CAAC,IAAI,CAACF,OAAO,EAAE,IAAI,CAAClB,OAAO,CAAC;AAChE,IAAA;AACF,EAAA;AAEAqB,EAAAA,UAAUA,GAAG;AACXvB,IAAAA,iBAAiB,CAACI,QAAQ,EAAEoB,GAAG,CAAC,IAAI,CAACJ,OAAO,EAAE,IAAI,CAACN,OAAO,CAAC;AAC7D,EAAA;AAEAW,EAAAA,aAAaA,GAAG;IACdzB,iBAAiB,CAACI,QAAQ,EAAEsB,MAAM,CAAC,IAAI,CAACN,OAAO,CAAC;AAClD,EAAA;AACF;;AAEA;AACA;AACA;AACA,SAASF,SAASA,CAACS,QAA2B,EAAE;AAC9C,EAAA,IAAIA,QAAQ,CAACP,OAAO,IAAIpB,iBAAiB,CAACG,QAAQ,EAAE;IAClDH,iBAAiB,CAACG,QAAQ,CAACe,SAAS,CAACS,QAAQ,CAACP,OAAO,CAAC;IACtDO,QAAQ,CAACF,aAAa,EAAE;AAC1B,EAAA;AACF;;;;"}